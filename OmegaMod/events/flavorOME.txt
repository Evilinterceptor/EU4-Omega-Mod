#Events for the Omega

namespace = flavor_ome

#Turns a random AI country into the Omega
country_event = {
    id = flavor_ome.1
    title = flavor_ome.1.t
    desc = flavor_ome.1.d
    picture = RELIGIOUS_TURMOIL_eventPicture
    fire_only_once = yes

    trigger = {
        NOT = { exists = OME }
        is_year = 1444
        ai = no #Important distinction - this event informs the player of the Omega's birth, but does not turn them into the Omega
    }

    mean_time_to_happen = {
        days = 1 
    }

    option = { 
        name = flavor_ome.1.a
        random_country {

            limit {
                ai = yes #Because turning a human into the Omega would be unfun.
                #This should prevent the Omega from spawning from a player's subject.
                NOT = {
                    any_country = {
                        overlord_of = ROOT
                    }
                }
            }
            #Effects begin here.
            {
                change_technology_group = omegan
                change_tag = OME
                change_unit_type = western #Placeholder
                swap_free_idea_group = yes #Get the Omega ideas

                every_province = {
                    limit = {
                        owned_by = OME
                        }
                    add_core = OME #Omega should get cores on its "host" nation
                }

                #If the Omega is tribal, turn it into a monarchy and remove any native councils
                if {
                    owner = {
                        OR = { government = tribal_despotism government = tribal_kingdom government = tribal_federation government = steppe_horde government = siberian_native_council government = tribal_democracy government = native_council }
                    }
                    change_government = despotic_monarchy
                    native_mechanic = no #Still needs fixing
                }

                #Increase the wealth of one of the Omega's provinces, giving it a boost, especially if it's small
                random_province {
                    limit = {
                        owned_by = OME
                        }
                    add_base_tax = 5
                    add_province_manpower = 5 
                }

                #If the Omega starts out as a vassal of an AI, it inherits its overlord.
                #This code doesn't work yet; that's why it's commented out.
                #any_country {
                #    limit = {
                #        #overlord_of = OME
                #        ai = yes #Safety measure to prevent the Omega from insta-inheriting the player, although the Omega should not spawn from a player's vassal.
                #    }
                #    
                #    free_vassal = OME #Initial step, good for debugging
                #    set_country_flag = omegan_relocation
                #}

                #OME = {
                #    inherit = {
                #        any_country {
                #            has_country_flag = omegan_relocation
                #        }
                #    }
                #}
                #Devassalization block ends here
            }
        }
    }
}


#Anti-protectorate event
country_event = {
    id = flavor_ome.2
    title = flavor_ome.2.t
    desc = flavor_ome.2.d
    picture = RELIGIOUS_TURMOIL_eventPicture

    trigger {
        tag = OME
    }

    mean_time_to_happen = {
        months = 30 #Adjust as needed?
    }

    option = { 
        name = flavor_ome.2.a 
        option = {
            random_subject_country = {
                limit = {
                    is_protectorate = yes 
                    NOT = { is_colonial_nation_of = OME } Bad things happen if colonial nations get vassalized
                }
            }
            PREV = { vassalize = PREV } #Should ensure diplomatic annexation at some point, at the very least
        }
    }
}

#Free explorers for the Omega once it has ships (based off "Merchant Expedition in RandomEvents.txt"), even if it doesn't take exploration ideas

country_event = {
    id = flavor_ome.3
    title = flavor_ome.3.t
    desc = flavor_ome.3.d
    picture = EXPLORERS_eventPicture
    
    trigger = {
        num_of_ports = 1
        tag = OME
    }
    
    mean_time_to_happen = {
        months = 120
    }
    
    option = {
        name = flavor_ome.3.a
        random_owned_province = {
            limit = { has_port = yes }
            heavy_ship = ROOT
        }
        create_explorer = 50
    }
}

